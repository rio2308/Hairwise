<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin – Bestellungen verwalten | Hairwise</title>
  <link rel="shortcut icon" href="logo.png" type="image/x-icon" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background: linear-gradient(135deg, #f8f4ff 0%, #ede7f6 100%);
      color: #2d1b4e;
      line-height: 1.6;
    }

    ::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #6a4c93, #c39bd3);
      border-radius: 20px;
      border: 2px solid transparent;
      background-clip: content-box;
    }

    ::-webkit-scrollbar-track {
      background: rgba(106, 76, 147, 0.1);
      border-radius: 20px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #5a3d7a, #b388c7);
    }

    /* Header icons gliich wie bim index */
    .header-icons {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .cart-icon img, .admin-icon img {
      height: 30px;
      width: auto;
      cursor: pointer;
      filter: brightness(0) invert(1);
      transition: all 0.3s ease;
      z-index: 2;
    }

    .cart-icon:hover img, .admin-icon:hover img {
      transform: scale(1.1);
      filter: brightness(0) invert(1) drop-shadow(0 0 10px rgba(247, 220, 111, 0.8));
    }

    .container {
      max-width: 1200px;
      width: 100%;
      margin: 40px auto;
      padding: 32px 24px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(106,76,147,0.13);
    }

    /* Header */
    header {
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 40px;
      background: linear-gradient(135deg, #6a4c93 0%, #8b5a9f 100%);
      box-shadow: 0 4px 20px rgba(106, 76, 147, 0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
      overflow: hidden;
      margin-bottom: 20px;
    }

    /* Update navigation gliich wie bim index */
    nav {
      display: flex;
      gap: 20px;
      z-index: 2;
    }

    nav a {
      text-decoration: none;
      color: #ffffff;
      font-weight: 500;
      font-size: 17px;
      transition: all 0.3s ease;
      position: relative;
      padding: 10px 20px;
      border-radius: 8px;
      letter-spacing: 0.5px;
    }

    nav a::after {
      content: '';
      position: absolute;
      bottom: 6px;
      left: 20px;
      right: 20px;
      height: 2px;
      background: #ffffff;
      transform: scaleX(0);
      transition: transform 0.3s ease;
      opacity: 0.7;
    }

    nav a:hover::after {
      transform: scaleX(1);
    }

    /* Update button */
    #loadOrdersBtn, .logout-btn {
      display: inline-block;
      padding: 14px 32px;
      font-size: 18px;
      font-weight: 600;
      background: linear-gradient(135deg, #836d9c, #836d9c);
      color: #fff;
      text-decoration: none;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: none;
      cursor: pointer;
    }

    #loadOrdersBtn:hover, .logout-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25);
      background: linear-gradient(135deg, #987db8, #987db8);
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 30px;
      background: linear-gradient(135deg, #6a4c93, #8b5a9f, #c39bd3);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
      /* Header-Styling */
      header {
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 40px;
      background: linear-gradient(135deg, #6a4c93 0%, #8b5a9f 100%);
      box-shadow: 0 4px 20px rgba(106, 76, 147, 0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
      overflow: hidden;
      margin-bottom: 20px;
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
      opacity: 0.3;
    }

    /* Logo */
    .logo img {
      height: 70px;
      width: auto;
      filter: drop-shadow(0 2px 10px rgba(255, 255, 255, 0.3));
    }
/* Warenkorb Icon */
.cart-icon img {
      height: 40px;
      width: auto;
      cursor: pointer;
      filter: brightness(0) invert(1);
      transition: all 0.3s ease;
      z-index: 2;
    }
    
    .cart-icon:hover img {
      transform: scale(1.1);
      filter: brightness(0) invert(1) drop-shadow(0 0 10px rgba(247, 220, 111, 0.8));
    }
    /* Navigation */
    nav {
      display: flex;
      gap: 20px;
      z-index: 2;
    }

    nav a {
      text-decoration: none;
      color: #ffffff;
      font-weight: 500;
      font-size: 17px;
      transition: all 0.3s ease;
      position: relative;
      padding: 10px 20px;
      border-radius: 8px;
      letter-spacing: 0.5px;
    }

    nav a::after {
      content: '';
      position: absolute;
      bottom: 6px;
      left: 20px;
      right: 20px;
      height: 2px;
      background: #ffffff;
      transform: scaleX(0);
      transition: transform 0.3s ease;
      opacity: 0.7;
    }

    nav a:hover {
      color: #ffffff;
      background: rgba(255, 255, 255, 0.1);
    }

    nav a:hover::after {
      transform: scaleX(1);
    }
    
    nav a.active {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    nav a.active::after {
      transform: scaleX(1);
      background: #f7dc6f;
      opacity: 1;
    }

        /* Warenkorb Icon */
        .cart-icon img {
      height: 40px;
      width: auto;
      cursor: pointer;
      filter: brightness(0) invert(1);
      transition: all 0.3s ease;
      z-index: 2;
    }
    
    .cart-icon:hover img {
      transform: scale(1.1);
      filter: brightness(0) invert(1) drop-shadow(0 0 10px rgba(247, 220, 111, 0.8));
    }

    #loginForm, #adminContent {
      max-width: 400px;
      margin: 0 auto 30px auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    #loginForm input, #loginForm button {
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1.5px solid #c39bd3;
    }
    #loginForm button {
      background: linear-gradient(135deg, #6a4c93 0%, #8b5a9f 100%);
      color: #fff;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    #loginForm button:hover {
      background: linear-gradient(135deg, #5a3d7a 0%, #b388c7 100%);
    }
    .order-list {
      margin-top: 30px;
    }
    .order-item {
      border: 1px solid #ede7f6;
      border-radius: 10px;
      padding: 18px 16px;
      margin-bottom: 18px;
      background: #faf7ff;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .order-header {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 4px;
    }
    .delete-btn {
      background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 20px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      align-self: flex-end;
      margin-top: 8px;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background: linear-gradient(135deg, #cc0000 0%, #ff4444 100%);
    }
    .success-message, .error-message {
      text-align: center;
      margin: 18px 0;
      padding: 12px;
      border-radius: 8px;
      font-weight: 500;
    }
    .success-message { background: #e8f5e9; color: #2e7d32; }
    .error-message { background: #ffebee; color: #c62828; }
        /* Footer */
        footer {
      background: linear-gradient(135deg, #2d1b4e 0%, #4a2c6b 100%);
      color: #ffffff;
      margin-top: auto;
      position: relative;
      overflow: hidden;
      padding: 40px 0 20px;
      margin-top: 50px;
    }

    footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M20 20c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10zm10 0c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10z'/%3E%3C/g%3E%3C/svg%3E") repeat;
    }
    
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
    }
    
    .footer-logo {
      margin-bottom: 20px;
    }
    
    .footer-logo img {
      filter: brightness(0) invert(1);
      opacity: 0.8;
    }
    
    .footer-links {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .footer-links a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    
    .footer-links a:hover {
      color: #f7dc6f;
      text-decoration: underline;
    }
    
    .footer-copyright {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
    }

    .edit-quantity {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
    }

    .edit-quantity input {
      width: 60px;
      padding: 4px 8px;
      border: 1px solid #c39bd3;
      border-radius: 4px;
    }

    .save-btn {
      background: linear-gradient(135deg, #6a4c93 0%, #8b5a9f 100%);
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 4px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .save-btn:hover {
      background: linear-gradient(135deg, #5a3d7a 0%, #b388c7 100%);
    }
  </style>
</head>

<body>
    <header>
        <!-- Logo ganz links -->
        <div class="logo">
          <a href="index.html"><img src="logo.png" alt="Hairshop Logo" /></a>
        </div>
    
        <!-- Navigation -->
        <nav>
          <a href="index.html">Home</a>
          <a href="about.html" class="active">About Us</a>
          <a href="products.html">Produkte</a>
          <a href="kontakt.html">Kontakt</a>

        </nav>
    
        <!-- Warenkorb Icon ganz rechts -->
        <div class="header-icons">
          <div class="cart-icon">
            <a href="warenkorb.html">
              <img src="cart-icon.png" alt="Warenkorb" />
            </a>
          </div>
          <div class="admin-icon">
            <a href="admin.html">
              <img src="anmelde-icon.png" alt="Admin Login" />
            </a>
          </div>
        </div>
      </header>
      
  <div class="container">
    <h1>Admin – Bestellungen verwalten</h1>
    <form id="loginForm">
      <input type="text" id="adminUser" placeholder="Admin Benutzername" required />
      <input type="password" id="adminPass" placeholder="Admin Passwort" required />
      <button type="submit">Login</button>
      <div id="loginMsg"></div>
    </form>
    <div id="adminContent" style="display:none;">
      <button id="loadOrdersBtn" style="margin-bottom:20px;">Bestellungen laden</button>
      <div id="ordersList"></div>
    </div>
  </div>
  <script>

    //mit API verbinden
const BASE_URL = 'https://pb20.toiwxr.easypanel.host/api';
let adminToken = null;

// Werte vo de eingabefeldern lesen
document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const user = document.getElementById('adminUser').value.trim();
  const pass = document.getElementById('adminPass').value.trim();
  const msg = document.getElementById('loginMsg');
  msg.textContent = '';
  msg.className = '';

  try {
    // Luegt i de collection nach em Admin User
    const checkRes = await fetch(`${BASE_URL}/collections/admin/records?filter=(adminUser="${encodeURIComponent(user)}")`);
    const data = await checkRes.json();

// Prüft ob e gültigi Antwort zrugg chunt
    if (!data || !data.items || !Array.isArray(data.items)) {
      throw new Error('Fehler beim Abrufen der Admin-Daten');
    }
// Prüeft ob en Admin mit dem  Namen existiert, wenn nöd denn das
    if (!data.items.length) {
      throw new Error('Admin nicht gefunden');
    }
// verglicht passwort
    const admin = data.items[0];
    if (admin.adminPass !== pass) {
      throw new Error('Ungültiges Passwort');
    }

    adminToken = admin.id; // Mir benutzed admin ID zum authorization

    msg.textContent = 'Login erfolgreich!';
    msg.className = 'success-message';
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('adminContent').style.display = 'block';
    
    // Bestellungen laden nach log in
    loadOrders();

    //fehlermeldung falls laden nicht funktioniert
  } catch (err) {
    msg.textContent = err.message;
    msg.className = 'error-message';
  }
});

// Lade vo de bstellige de button
async function loadOrders() {
  const ordersList = document.getElementById('ordersList');
  ordersList.innerHTML = 'Lade Bestellungen...';

  try {
    // Produkte abrufen und in ein Map-Objekt speichern die ID ist Produktname
    let productsMap = {};
    try {
      const productsRes = await fetch(`${BASE_URL}/collections/products/records?perPage=100`); //nimmt die produckte von API products collection
      const productsData = await productsRes.json();
      if (productsData?.items) {
        productsData.items.forEach(p => {
          if (p?.id && p?.name) productsMap[p.id] = p.name;
        });
      }
    } catch (e) {
      console.log('Produkte laden fehlgeschlagen:', e);
    }

    // bstellige abrüefe
    const ordersRes = await fetch(`${BASE_URL}/collections/orders/records?sort=-created`);
    const data = await ordersRes.json();
    
    ordersList.innerHTML = '';

    // bstellige ahzeige
    try {
      data?.items?.forEach(order => {
        const orderDiv = document.createElement('div');
        orderDiv.className = 'order-item';
        //in HTML machen
        orderDiv.innerHTML = `
          <div class="order-header">
            <strong>${order?.customerName || 'Unbekannt'}</strong>
            <span class="order-date">${new Date(order?.created || Date.now()).toLocaleString('de-DE')}</span>
          </div>
          <div class="order-address">${order?.adress || '-'}</div>
          <div class="order-products">Produkte: ${(order?.products || []).map(pid => productsMap[pid] || pid).join(', ') || '-'}</div>
          <div class="order-quantity">
            Menge: 
            <div class="edit-quantity">
              <input type="number" value="${order?.menge || 0}" min="1" class="quantity-input">
              <button class="save-btn">Speichern</button>
            </div>
          </div>
          <button class="delete-btn" data-id="${order?.id || ''}">Löschen</button>
        `;

        // Löschen Button Event Listener (heisst wenn wenn man drauf klickt wir aktion durchgeführt)
        orderDiv.querySelector('.delete-btn').addEventListener('click', async function() {
          if (!confirm('Möchten Sie diese Bestellung wirklich löschen?')) return;

          try {
            const deleteRes = await fetch(`${BASE_URL}/collections/orders/records/${order.id}`, {
              method: 'DELETE'
            });

            if (!deleteRes.ok) {
              throw new Error('Löschen fehlgeschlagen');
            }

            // Löschen der Bestellung aus der Anzeige
            orderDiv.remove();

            // Bestätigungs nachricht anzeigen
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.textContent = 'Bestellung erfolgreich gelöscht';
            ordersList.insertBefore(successMsg, ordersList.firstChild);
            
            // benachrichtigung weg machen nach 3 sekunden
            setTimeout(() => successMsg.remove(), 3000);

          } catch (err) {
            console.error('Delete error:', err);
            const errorMsg = document.createElement('div');
            errorMsg.className = 'error-message';
            errorMsg.textContent = `Fehler beim Löschen: ${err.message}`;
            orderDiv.appendChild(errorMsg);
            
            setTimeout(() => errorMsg.remove(), 3000);
          }
        });

        // Speicher-Button der Mengenanpassung
        orderDiv.querySelector('.save-btn').addEventListener('click', async function() {
          const newQuantity = parseInt(orderDiv.querySelector('.quantity-input').value);
          //prüefen ob zahl gültig isch wenn nicht dann
          if (isNaN(newQuantity) || newQuantity < 1) {
            alert('Bitte geben Sie eine gültige Menge ein');
            return;
          }

          try {
            //Patch anfragen zum Aktualisieren der Menge
            const patchRes = await fetch(`${BASE_URL}/collections/orders/records/${order.id}`, {
              method: 'PATCH',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                menge: newQuantity
              })
            });

            if (!patchRes.ok) {
              throw new Error('Aktualisierung fehlgeschlagen');
            }

            // Erfolgsmeldig ahzeige
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.textContent = 'Menge erfolgreich aktualisiert';
            orderDiv.appendChild(successMsg);
            
            // Erfolgsmeldung entfernen nach 3 sekunde
            setTimeout(() => successMsg.remove(), 3000);

          } catch (err) {
            console.error('Update error:', err);
            const errorMsg = document.createElement('div');
            errorMsg.className = 'error-message';
            errorMsg.textContent = `Fehler beim Aktualisieren: ${err.message}`;
            orderDiv.appendChild(errorMsg);
            
            setTimeout(() => errorMsg.remove(), 3000);
          }
        });

        //Bestellung in die Liste einfügen
        ordersList.appendChild(orderDiv);
      });
    } catch (e) {
        //falls keine bestellung vorhanden sind
      ordersList.innerHTML = '<div class="info-message">Keine Bestellungen verfügbar.</div>';
    }

  } catch (err) {
    //Fehler beim Laden der bestellungen
    ordersList.innerHTML = '<div class="error-message">Fehler beim Laden</div>';
  }
}

// Laden der Bestellung per Button
document.getElementById('loadOrdersBtn').addEventListener('click', loadOrders);

// Log out funktion
const logoutBtn = document.createElement('button');
logoutBtn.textContent = 'Logout';
logoutBtn.className = 'logout-btn';
logoutBtn.onclick = () => {
    //Formularansicht wieder anzeigen
  adminToken = null;
  document.getElementById('loginForm').style.display = 'block';
  document.getElementById('adminContent').style.display = 'none';
  document.getElementById('loginForm').reset();
};
// Logout Button in den Admin Content einfügen
document.getElementById('adminContent').prepend(logoutBtn);
</script>

<footer>
    <div class="footer-content">
      <div class="footer-logo">
        <img src="logo.png" alt="Hairwise Logo" width="80" height="80">
      </div>
      <div class="footer-links">
        <a href="index.html">Home</a>
        <a href="about.html">About Us</a>
        <a href="products.html">Produkte</a>
        <a href="kontakt.html">Kontakt</a>
      </div>
      <div class="footer-copyright">
        &copy; 2025 Hairwise – Ihr Experte für hochwertige Haarprodukte
      </div>
    </div>
  </footer>
</body>
</html>