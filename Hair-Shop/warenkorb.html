<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Webshop mit PocketBase</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background-color: #fdfdfd;
      color: #333;
    }

    .product-card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin: auto;
      width: 200px;
      display: inline-block;
      vertical-align: top;
      text-align: center;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 60px;
      color: #836d9c;
    }

    .product-image {
      max-width: 100%;
      height: 120px;
      object-fit: contain;
      margin-bottom: 10px;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    #cartItems tr td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }

    #orderStatus {
      margin-top: 15px;
      font-weight: bold;
    }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    th, td {
      text-align: left;
      padding: 8px;
      border-bottom: 1px solid #ccc;
    }

    footer {
      background-color: #f3f3f3;
      text-align: center;
      padding: 20px 0;
      font-size: 14px;
      color: #555;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.8);
    }

    .warenkorb-zusammen {
      padding-left: 200px;
      padding-right: 200px;
      padding-bottom: 40px;
    }

    header {
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 40px;
      background-color: #ffffff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .logo img {
      height: 140px;
      width: auto;
    }

    nav {
      display: flex;
      gap: 40px;
    }

    nav a {
      margin-right: 50px;
      text-decoration: none;
      color: #2a1342;
      font-weight: bold;
      font-size: 20px;
      transition: color 0.3s;
    }

    nav a:hover {
      color: #836d9c;
    }

    .cart-icon img {
      height: 40px;
      width: auto;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <a href="index.html"><img src="logo.png" alt="Hairshop Logo" /></a>
    </div>

    <nav>
      <a href="index.html">Home</a>
      <a href="about.html">About Us</a>
      <a href="products.html">Produkte</a>
      <a href="kontakt.html">Kontakt</a>
      <a href="warenkorb.html">Warenkorb</a>
    </nav>

    <div class="cart-icon">
      <a href="warenkorb.html">
        <img src="cart-icon.png" alt="Warenkorb" />
      </a>
    </div>
  </header>

  <h1>Warenkorb</h1>
  <div class="warenkorb-zusammen">
    <table id="cartTable">
      <thead>
        <tr><th>Produkt</th><th>Preis (CHF)</th><th>Aktion</th></tr>
      </thead>
      <tbody id="cartItems"></tbody>
    </table>
    <p id="emptyCartMessage">Der Warenkorb ist leer.</p>

    <h2>Bestellung abschicken</h2>
    <form id="orderForm">
      <input type="text" id="customerName" placeholder="Ihr Name" required /><br /><br />
      <input type="text" id="adress" placeholder="Ihre Adresse" required /><br /><br />
      <input type="hidden" id="productIds" name="productIds" />
      <button type="submit">Bestellen</button>
    </form>
  </div>
  <div id="orderStatus"></div>

  <script>
    const BASE_URL = 'https://pb20.toiwxr.easypanel.host/api/collections';

    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function addToCart(product) {
      if (cart.find(item => item.id === product.id)) {
        alert('Produkt ist bereits im Warenkorb.');
        return;
      }
      cart.push(product);
      saveCart();
      renderCart();
    }

    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      saveCart();
      renderCart();
    }

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function renderCart() {
      const tbody = document.getElementById('cartItems');
      const emptyMessage = document.getElementById('emptyCartMessage');
      tbody.innerHTML = '';

      if (cart.length === 0) {
        emptyMessage.style.display = 'block';
      } else {
        emptyMessage.style.display = 'none';
      }

      cart.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.name}</td>
          <td>CHF ${item.price}</td>
          <td><button data-id="${item.id}">Entfernen</button></td>
        `;
        tr.querySelector('button').addEventListener('click', () => {
          removeFromCart(item.id);
        });
        tbody.appendChild(tr);
      });

      // üëá Produkt-IDs ins versteckte Feld schreiben
      document.getElementById('productIds').value = cart.map(p => p.id).join(',');
    }

    document.getElementById('orderForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const customerName = document.getElementById('customerName').value.trim();
      const adress = document.getElementById('adress').value.trim();
      const orderStatus = document.getElementById('orderStatus');

      if (cart.length === 0) {
        orderStatus.textContent = 'Ihr Warenkorb ist leer.';
        orderStatus.style.color = 'red';
        return;
      }

      if (!customerName || !adress) {
        orderStatus.textContent = 'Bitte Name und Adresse ausf√ºllen.';
        orderStatus.style.color = 'red';
        return;
      }

      const orderData = {
        customerName,
        adress,
        products: cart.map(p => p.id)
      };

      try {
        const res = await fetch(`${BASE_URL}/orders/records`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(orderData)
        });

        if (!res.ok) throw new Error('Fehler beim Absenden der Bestellung');

        orderStatus.textContent = 'Bestellung erfolgreich abgeschickt. Vielen Dank!';
        orderStatus.style.color = 'green';

        cart = [];
        saveCart();
        renderCart();

        e.target.reset();
      } catch (err) {
        console.error(err);
        orderStatus.textContent = 'Fehler beim Absenden der Bestellung. Bitte versuchen Sie es sp√§ter erneut.';
        orderStatus.style.color = 'red';
      }
    });

    renderCart();
  </script>

  <footer>
    &copy; 2025 Hairwise ‚Äì Ihr Experte f√ºr hochwertige Haarprodukte
  </footer>
</body>
</html>
